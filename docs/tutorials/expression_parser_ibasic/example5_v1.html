<html>
<head>
<title>example5_v1.iba</title>
</head>
<!-- Generated by SynEdit HTML exporter -->
<body text="#000000" bgcolor="#FFFFFF">
<pre>
<code><font  size="3" face="Courier New"><font color="#008000"><b><i>/*
Recursive expression parser, Example 5
Written with IBasic Professional
By Jos de Jong, june 2006

Supports expressions with:
Operators: + - * / ^ E and parentheses ( )
Constants: Pi, e
Functions: Abs, Sqrt, Log, Log10, Exp, Int, Ceil, Floor,
           Sin, Cos, Tan, Acos, Atan, Sinh, Cosh, Tanh
Error handling is included.
*/
</i></b></font><font color="#0000FF">AUTODEFINE </font><font color="#800080">&quot;Off&quot;

</font><font color="#0000FF">TYPE </font><font color="#FF0000">MESSAGE        </font><font color="#008000"><b><i>'this type can store an error message
</i></b>    </font><font color="#FF0000">INT </font>t           <font color="#008000"><b><i>'type of the error
</i></b>    </font><font color="#FF0000">STRING </font>desc     <font color="#008000"><b><i>'description of the error
</i></b></font><font color="#0000FF">ENDTYPE

</font><font color="#008000"><b><i>'the following error types are available for error messages
</i></b></font><font color="#0000FF">CONST </font>MSG_EMPTY <font color="#000080">= </font><b>0
</b><font color="#0000FF">CONST </font>MSG_SYNTAXERROR <font color="#000080">= </font><b>1
</b><font color="#0000FF">CONST </font>MSG_DOMAINERROR <font color="#000080">= </font><b>2
</b><font color="#0000FF">CONST </font>MSG_INFO <font color="#000080">= </font><b>3
</b><font color="#0000FF">CONST </font>MSG_MEMERROR <font color="#000080">= </font><b>4
</b><font color="#0000FF">CONST </font>MSG_SYSTEMERROR <font color="#000080">= </font><b>5
</b><font color="#0000FF">CONST </font>MSG_OVERFLOW <font color="#000080">= </font><b>6


</b><font color="#0000FF">OPENCONSOLE

</font><font color="#008000"><b><i>'print some examples of expressions with their answers
</i></b></font><font color="#0000FF">PRINT </font><font color="#800080">&quot;Expression Calculator&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;Available constants: Pi, e&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;Available operators: + - * / ^ E and parentheses ( )&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;Available functions: Abs, Sqrt, Log, Log10, Exp, Int, Ceil, Floor,&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;                     Sin, Cos, Tan, Acos, Atan, Sinh, Cosh, Tanh&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;Enter an expression and press Enter to calculate it.&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;Enter an empty expression to quit&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;Examples:&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;2 + 3 * -4&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;    &quot;</font><font color="#000080">, </font>evalLine<font color="#000080">(</font><font color="#800080">&quot;2 + 3 * -4&quot;</font><font color="#000080">)
</font><font color="#0000FF">PRINT
PRINT </font><font color="#800080">&quot;2 + 3 / 4 - 5&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;    &quot;</font><font color="#000080">, </font>evalLine<font color="#000080">(</font><font color="#800080">&quot;2 + 3 / 4 - 5&quot;</font><font color="#000080">)
</font><font color="#0000FF">PRINT
PRINT </font><font color="#800080">&quot;2.5 ^ 3.25 - 5E2 / 100&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;    &quot;</font><font color="#000080">, </font>evalLine<font color="#000080">(</font><font color="#800080">&quot;2.5 ^ 3.25 - 5E2 / 100 &quot;</font><font color="#000080">)
</font><font color="#0000FF">PRINT
PRINT </font><font color="#800080">&quot;(1.5+2.5) * Sin(0.25*Pi)^2&quot;
</font><font color="#0000FF">PRINT </font><font color="#800080">&quot;    &quot;</font><font color="#000080">, </font>evalLine<font color="#000080">(</font><font color="#800080">&quot;(1.5+2.5) * Sin(0.25*Pi)^2&quot;</font><font color="#000080">)
</font><font color="#0000FF">PRINT

DEF </font>inputexpr<font color="#000080">:</font><font color="#FF0000">STRING
</font><font color="#0000FF">DO
    </font><font color="#008000"><b><i>'ask the user to enter an expression. After this the expression
</i></b>    <b><i>'will be evaluated and the answer will be printed
</i></b>    </font><font color="#0000FF">INPUT </font><font color="#800080">&quot;&gt;&gt;&quot;</font><font color="#000080">, </font>inputexpr
    <font color="#0000FF">IF RTRIM$</font><font color="#000080">(</font>inputexpr<font color="#000080">)&lt;&gt;</font><font color="#800080">&quot;&quot;
        </font><font color="#0000FF">PRINT </font><font color="#800080">&quot;    &quot;</font><font color="#000080">, </font>evalLine<font color="#000080">(</font>inputexpr<font color="#000080">)
        </font><font color="#0000FF">PRINT </font><font color="#800080">&quot;&quot;
    </font><font color="#0000FF">ENDIF
UNTIL RTRIM$</font><font color="#000080">(</font>inputexpr<font color="#000080">)=</font><font color="#800080">&quot;&quot;

</font><font color="#008000"><b><i>'end the program
</i></b></font><font color="#0000FF">CLOSECONSOLE
END

</font><font color="#008000"><b><i>'_______________________________________________________________
</i></b></font><font color="#0000FF">SUB </font>evalLine<font color="#000080">(</font>expression<font color="#000080">:</font><font color="#FF0000">STRING</font><font color="#000080">), </font><font color="#FF0000">STRING
    </font><font color="#008000"><b><i>'this sub evaluates the expression and returns a string that
</i></b>    <b><i>'can contain the answer or an (error) message. The expression can
</i></b>    <b><i>'have values, operators + - * / ^ E and parentheses ( )
</i></b>    </font><font color="#FF0000">DOUBLE </font>ans
    <font color="#FF0000">MESSAGE </font>msg
    
    <font color="#008000"><b><i>'make the error message empty (ready for use)
</i></b>    </font>errClear<font color="#000080">(</font>msg<font color="#000080">)
    
    </font><font color="#008000"><b><i>'evaluate the expression
</i></b>    </font>ans <font color="#000080">= </font>eval<font color="#000080">(</font>expression<font color="#000080">, </font>msg<font color="#000080">)
    
    </font><font color="#008000"><b><i>'return (error) message if not empty
</i></b>    </font><font color="#0000FF">IF </font>msg<font color="#000080">.</font>t<font color="#000080">&lt;&gt;</font>MSG_EMPTY <font color="#0000FF">THEN RETURN </font>msg<font color="#000080">.</font>desc
    
    <font color="#008000"><b><i>'if no error occured, return the answer
</i></b>    </font><font color="#0000FF">RETURN </font><font color="#800080">&quot;Ans = &quot; </font><font color="#000080">+ </font><font color="#0000FF">USING</font><font color="#000080">(</font><font color="#800080">&quot;#.#####&quot;</font><font color="#000080">, </font>ans<font color="#000080">)
</font><font color="#0000FF">ENDSUB

</font><font color="#008000"><b><i>'_____________________________________________________________________
</i></b></font><font color="#0000FF">SUB </font>Eval<font color="#000080">(</font>Expression<font color="#000080">:</font><font color="#FF0000">STRING</font><font color="#000080">, </font>msg<font color="#000080">:</font><font color="#FF0000">MESSAGE</font><font color="#000080">), </font><font color="#FF0000">DOUBLE
    </font><font color="#008000"><b><i>'evaluate the given expression.
</i></b>    <b><i>'The evaluation is done in the following steps:
</i></b>    <b><i>'1. Search for an operator with the lowest precedence, outside parentheses
</i></b>    <b><i>'2. Try if the expression starts with a function, like &quot;Sin(0.5*pi)&quot;
</i></b>    <b><i>'3. Try if the expression is a value
</i></b>    <b><i>'4. Try if the expression is a variable
</i></b>    </font><font color="#0000FF">DEF </font>pos<font color="#000080">, </font>n<font color="#000080">:</font><font color="#FF0000">INT
    </font><font color="#0000FF">DEF </font>expr<font color="#000080">:</font><font color="#FF0000">STRING
    </font><font color="#0000FF">DEF </font>part1<font color="#000080">, </font>part2<font color="#000080">:</font><font color="#FF0000">STRING
    </font><font color="#0000FF">DEF </font>value1<font color="#000080">, </font>value2<font color="#000080">:</font><font color="#FF0000">DOUBLE
    </font><font color="#0000FF">DEF </font>operator<font color="#000080">:</font><font color="#FF0000">STRING
    </font><font color="#0000FF">DEF </font>function<font color="#000080">:</font><font color="#FF0000">STRING
    
    </font><font color="#008000"><b><i>'remove spaces at start and end of the expression
</i></b>    </font>expr <font color="#000080">= </font><font color="#0000FF">LTRIM$</font><font color="#000080">(</font><font color="#0000FF">RTRIM$</font><font color="#000080">(</font>Expression<font color="#000080">))
    
    </font><font color="#0000FF">FOR </font>n<font color="#000080">=</font><b>1</b> <font color="#0000FF">TO </font><b>6
</b>        <font color="#008000"><b><i>'choose an operator
</i></b>        <b><i>'(for each loop choose the following of the five operators)
</i></b>        </font>operator <font color="#000080">= </font><font color="#0000FF">MID$</font><font color="#000080">(</font><font color="#800080">&quot;-+/*^E&quot;</font><font color="#000080">, </font>n<font color="#000080">, </font><b>1</b><font color="#000080">)
        
        </font><font color="#008000"><b><i>'search for the last occurance of this operator outside
</i></b>        <b><i>'parentheses
</i></b>        </font>pos <font color="#000080">= </font>InstrP<font color="#000080">(</font><font color="#0000FF">UCASE$</font><font color="#000080">(</font>expr<font color="#000080">), </font>operator<font color="#000080">, </font><b>255</b><font color="#000080">)
        </font><font color="#0000FF">WHILE </font>pos<font color="#000080">&gt;</font><b>0
</b>            <font color="#008000"><b><i>'Check if the found operator realy is an operator
</i></b>            <b><i>'(and not a unary plus or minus)
</i></b>            </font><font color="#0000FF">IF </font>isOperator<font color="#000080">(</font>expr<font color="#000080">, </font>operator<font color="#000080">, </font>pos<font color="#000080">)=</font><font color="#FF8000">TRUE
                </font><font color="#008000"><b><i>'there is an operator found at position pos. Split up
</i></b>                <b><i>'the expression in two parts and calculate the result
</i></b>                <b><i>'of that two parts. Then calculate the result for the
</i></b>                <b><i>'complete expression.
</i></b>                </font>part1 <font color="#000080">= </font><font color="#0000FF">LEFT$</font><font color="#000080">(</font>expr<font color="#000080">, </font>pos<font color="#000080">-</font><b>1</b><font color="#000080">)
                </font>part2 <font color="#000080">= </font><font color="#0000FF">RIGHT$</font><font color="#000080">(</font>expr<font color="#000080">, </font><font color="#0000FF">LEN</font><font color="#000080">(</font>expr<font color="#000080">)-</font>pos<font color="#000080">)
                
                </font><font color="#008000"><b><i>'If part1 and part2 are empty fill in an error message and return
</i></b>                </font><font color="#0000FF">IF RTRIM$</font><font color="#000080">(</font>part1<font color="#000080">)=</font><font color="#800080">&quot;&quot;
                    </font>errSet<font color="#000080">(</font>msg<font color="#000080">, </font>MSG_SYNTAXERROR<font color="#000080">, </font><font color="#800080">&quot;Error: Missing value before operator &quot; </font><font color="#000080">+ </font>operator<font color="#000080">)
                    </font><font color="#0000FF">RETURN </font><b>0
</b>                <font color="#0000FF">ENDIF
                IF RTRIM$</font><font color="#000080">(</font>part2<font color="#000080">)=</font><font color="#800080">&quot;&quot;
                    </font>errSet<font color="#000080">(</font>msg<font color="#000080">, </font>MSG_SYNTAXERROR<font color="#000080">, </font><font color="#800080">&quot;Error: Missing value after operator &quot; </font><font color="#000080">+ </font>operator<font color="#000080">)
                    </font><font color="#0000FF">RETURN </font><b>0
</b>                <font color="#0000FF">ENDIF
                
                </font><font color="#008000"><b><i>'calculate the left and the right part
</i></b>                </font>value1 <font color="#000080">= </font>Eval<font color="#000080">(</font>part1<font color="#000080">, </font>msg<font color="#000080">)
                </font>value2 <font color="#000080">= </font>Eval<font color="#000080">(</font>part2<font color="#000080">, </font>msg<font color="#000080">)
                
                </font><font color="#008000"><b><i>'now execute the operation between left and right
</i></b>                <b><i>'part, and return the answer
</i></b>                </font><font color="#0000FF">SELECT </font>operator
                    <font color="#0000FF">CASE </font><font color="#800080">&quot;-&quot;
                        </font><font color="#0000FF">RETURN </font>value1 <font color="#000080">- </font>value2
                    <font color="#0000FF">CASE </font><font color="#800080">&quot;+&quot;
                        </font><font color="#0000FF">RETURN </font>value1 <font color="#000080">+ </font>value2
                    <font color="#0000FF">CASE </font><font color="#800080">&quot;/&quot;
                        </font><font color="#008000"><b><i>'If value2 is zero, return an error message
</i></b>                        </font><font color="#0000FF">IF </font>value2<font color="#000080">=</font><b>0
</b>                            errSet<font color="#000080">(</font>msg<font color="#000080">, </font>MSG_DOMAINERROR<font color="#000080">, </font><font color="#800080">&quot;Error: Divide by zero&quot;</font><font color="#000080">)
                            </font><font color="#0000FF">RETURN </font><b>0
</b>                        <font color="#0000FF">ENDIF
                        RETURN </font>value1 <font color="#000080">/ </font>value2
                    <font color="#0000FF">CASE </font><font color="#800080">&quot;*&quot;
                        </font><font color="#0000FF">RETURN </font>value1 <font color="#000080">* </font>value2
                    <font color="#0000FF">CASE </font><font color="#800080">&quot;^&quot;
                        </font><font color="#0000FF">RETURN </font>value1 <font color="#000080">^ </font>value2
                    <font color="#0000FF">CASE </font><font color="#800080">&quot;E&quot;
                        </font><font color="#0000FF">RETURN </font>value1 <font color="#000080">* </font><b>10</b> <font color="#000080">^ </font>value2
                <font color="#0000FF">ENDSELECT
            ENDIF
            
            </font><font color="#008000"><b><i>'the found operator was no operator,
</i></b>            <b><i>'search if there is another operator before this one
</i></b>            </font><font color="#0000FF">IF </font>pos<font color="#000080">&gt;</font><b>0</b> <font color="#0000FF">THEN </font>pos <font color="#000080">= </font>instrP<font color="#000080">(</font><font color="#0000FF">UCASE$</font><font color="#000080">(</font>expr<font color="#000080">), </font>operator<font color="#000080">, </font>pos<font color="#000080">-</font><b>1</b><font color="#000080">)
        </font><font color="#0000FF">WEND
    NEXT </font>n
    
    <font color="#008000"><b><i>'check if the expression is a function, like &quot;Sin(2+3)&quot;
</i></b>    </font>pos <font color="#000080">= </font><font color="#0000FF">INSTR</font><font color="#000080">(</font>expr<font color="#000080">,</font><font color="#800080">&quot;(&quot;</font><font color="#000080">)
    </font><font color="#0000FF">IF </font>pos<font color="#000080">&gt;</font><b>0</b> <font color="#0000FF">AND RIGHT$</font><font color="#000080">(</font>expr<font color="#000080">,</font><b>1</b><font color="#000080">)=</font><font color="#800080">&quot;)&quot;
        </font><font color="#008000"><b><i>'extract the function name, for example &quot;Sin&quot;
</i></b>        </font>function <font color="#000080">= </font><font color="#0000FF">LTRIM$</font><font color="#000080">(</font><font color="#0000FF">LEFT$</font><font color="#000080">(</font>expr<font color="#000080">, </font>pos<font color="#000080">-</font><b>1</b><font color="#000080">))
        
        </font><font color="#008000"><b><i>'extract the expression inside the parentheses, &quot;2+3&quot;
</i></b>        <b><i>'evaluate this expression
</i></b>        </font>part2 <font color="#000080">= </font><font color="#0000FF">MID$</font><font color="#000080">(</font>expr<font color="#000080">, </font>pos<font color="#000080">+</font><b>1</b><font color="#000080">, </font><font color="#0000FF">LEN</font><font color="#000080">(</font>expr<font color="#000080">)-</font>pos<font color="#000080">-</font><b>1</b><font color="#000080">)
        </font>value2 <font color="#000080">= </font>Eval<font color="#000080">(</font>part2<font color="#000080">, </font>msg<font color="#000080">)
        
        </font><font color="#008000"><b><i>'evaluate the function
</i></b>        </font><font color="#0000FF">SELECT UCASE$</font><font color="#000080">(</font>function<font color="#000080">)
            </font><font color="#008000"><b><i>'if function=&quot;&quot;, then the expression is just enclosed
</i></b>            <b><i>'with brackets, like &quot;(2+3*4)&quot;
</i></b>            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;&quot;     </font><font color="#000080">:</font><font color="#0000FF">RETURN </font>value2
                
            <font color="#008000"><b><i>'arithmetic functions
</i></b>            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;ABS&quot;  </font><font color="#000080">:</font><font color="#0000FF">RETURN ABS</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;SQRT&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN SQRT</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;LOG&quot;  </font><font color="#000080">:</font><font color="#0000FF">RETURN LOG</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;LOG10&quot;</font><font color="#000080">:</font><font color="#0000FF">RETURN LOG10</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;EXP&quot;  </font><font color="#000080">:</font><font color="#0000FF">RETURN EXP</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;INT&quot;  </font><font color="#000080">:</font><font color="#0000FF">RETURN INT</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;CEIL&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN CEIL</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;FLOOR&quot;</font><font color="#000080">:</font><font color="#0000FF">RETURN FLOOR</font><font color="#000080">(</font>value2<font color="#000080">)
                
            </font><font color="#008000"><b><i>'Trigonometric functions
</i></b>            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;SIN&quot;  </font><font color="#000080">:</font><font color="#0000FF">RETURN SIN</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;COS&quot;  </font><font color="#000080">:</font><font color="#0000FF">RETURN COS</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;TAN&quot;  </font><font color="#000080">:</font><font color="#0000FF">RETURN TAN</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;ASIN&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN ASIN</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;ACOS&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN ACOS</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;ATAN&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN ATAN</font><font color="#000080">(</font>value2<font color="#000080">)
                
            </font><font color="#008000"><b><i>'Hyperbolic functions
</i></b>            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;SINH&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN SINH</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;COSH&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN COSH</font><font color="#000080">(</font>value2<font color="#000080">)
            </font><font color="#0000FF">CASE </font><font color="#800080">&quot;TANH&quot; </font><font color="#000080">:</font><font color="#0000FF">RETURN TANH</font><font color="#000080">(</font>value2<font color="#000080">)
                
            </font><font color="#008000"><b><i>'Unknown function
</i></b>            </font><font color="#0000FF">DEFAULT     </font><font color="#000080">:</font>errSet<font color="#000080">(</font>msg<font color="#000080">, </font>MSG_DOMAINERROR<font color="#000080">, </font><font color="#800080">&quot;Error: Unknown function \&quot;&quot; + function + &quot;</font><font color="#000080">\</font><font color="#800080">&quot;&quot;</font><font color="#000080">)
        </font><font color="#0000FF">ENDSELECT
    ENDIF
    
    </font><font color="#008000"><b><i>'The expression is not solved yet.
</i></b>    <b><i>'Check if the expression is a value. If so, return the value
</i></b>    </font><font color="#0000FF">IF </font>isValue<font color="#000080">(</font>expr<font color="#000080">) </font><font color="#0000FF">THEN RETURN VAL</font><font color="#000080">(</font>expr<font color="#000080">)
    
    </font><font color="#008000"><b><i>'check if the expression is equal to a constant, for example &quot;pi&quot; or &quot;e&quot;
</i></b>    <b><i>'if so, return the value of this constant
</i></b>    </font><font color="#0000FF">SELECT UCASE$</font><font color="#000080">(</font>expr<font color="#000080">)
        </font><font color="#0000FF">CASE </font><font color="#800080">&quot;PI&quot;   </font><font color="#000080">:</font><font color="#0000FF">RETURN </font><b>3.141592654
</b>        <font color="#0000FF">CASE </font><font color="#800080">&quot;E&quot;    </font><font color="#000080">:</font><font color="#0000FF">RETURN </font><b>2.718281828
</b>    <font color="#0000FF">ENDSELECT
    
    </font><font color="#008000"><b><i>'something unsupported happend. return an error message
</i></b>    </font>errSet<font color="#000080">(</font>msg<font color="#000080">, </font>MSG_SYNTAXERROR<font color="#000080">, </font><font color="#800080">&quot;Error: Syntax error in part \&quot;&quot; + expr + &quot;</font><font color="#000080">\</font><font color="#800080">&quot;&quot;</font><font color="#000080">)
    </font><font color="#0000FF">RETURN </font><b>0
</b><font color="#0000FF">ENDSUB

</font><font color="#008000"><b><i>'_____________________________________________________________________
</i></b></font><font color="#0000FF">SUB </font>instrP<font color="#000080">(</font>source<font color="#000080">:</font><font color="#FF0000">STRING</font><font color="#000080">, </font>search<font color="#000080">:</font><font color="#FF0000">STRING</font><font color="#000080">, </font>start<font color="#000080">:</font><font color="#FF0000">INT</font><font color="#000080">), </font><font color="#FF0000">INT
    </font><font color="#008000"><b><i>'this sub searches for the LAST string search in the string
</i></b>    <b><i>'source, reverse of the function instr(). The sub returns 0 if
</i></b>    <b><i>'the search could not be found. Also this function neglects
</i></b>    <b><i>'content between parenthesis () in source
</i></b>    </font><font color="#FF0000">INT </font>n<font color="#000080">, </font>bopen<font color="#000080">, </font>bclose
    <font color="#FF0000">STRING </font>sign
    
    n<font color="#000080">=</font>start
    <font color="#0000FF">IF </font>n<font color="#000080">&gt;</font><font color="#0000FF">LEN</font><font color="#000080">(</font>source<font color="#000080">) </font><font color="#0000FF">THEN </font>n<font color="#000080">=</font><font color="#0000FF">LEN</font><font color="#000080">(</font>source<font color="#000080">)-</font><font color="#0000FF">LEN</font><font color="#000080">(</font>search<font color="#000080">)+</font><b>1
</b>    bopen<font color="#000080">=</font><b>0</b>     <font color="#000080">:</font><font color="#008000"><b><i>'number of parenthesis open (
</i></b>    </font>bclose<font color="#000080">=</font><b>0</b>    <font color="#000080">:</font><font color="#008000"><b><i>'number of parenthesis close )
</i></b>    </font><font color="#0000FF">DO
        </font>sign <font color="#000080">= </font><font color="#0000FF">MID$</font><font color="#000080">(</font>source<font color="#000080">, </font>n<font color="#000080">, </font><font color="#0000FF">LEN</font><font color="#000080">(</font>search<font color="#000080">))
        </font><font color="#008000"><b><i>'if search is found and outside parentheses then return n
</i></b>        </font><font color="#0000FF">IF </font><font color="#000080">(</font>sign<font color="#000080">=</font>search<font color="#000080">) </font><font color="#0000FF">AND </font><font color="#000080">(</font>bopen<font color="#000080">=</font>bclose<font color="#000080">) </font><font color="#0000FF">THEN RETURN </font>n
        <font color="#0000FF">IF LEFT$</font><font color="#000080">(</font>sign<font color="#000080">,</font><b>1</b><font color="#000080">)=</font><font color="#800080">&quot;(&quot; </font><font color="#0000FF">THEN </font>bopen<font color="#000080">++
        </font><font color="#0000FF">IF LEFT$</font><font color="#000080">(</font>sign<font color="#000080">,</font><b>1</b><font color="#000080">)=</font><font color="#800080">&quot;)&quot; </font><font color="#0000FF">THEN </font>bclose<font color="#000080">++
        </font>n<font color="#000080">--
    </font><font color="#0000FF">UNTIL </font><font color="#000080">(</font>n <font color="#000080">&lt;= </font><b>0</b><font color="#000080">)
    
    </font><font color="#008000"><b><i>'if the string search is not found, then return 0
</i></b>    </font><font color="#0000FF">RETURN </font><b>0
</b><font color="#0000FF">ENDSUB

</font><font color="#008000"><b><i>'_______________________________________________________________
</i></b></font><font color="#0000FF">SUB </font>isOperator<font color="#000080">(</font>expr<font color="#000080">:</font><font color="#FF0000">STRING</font><font color="#000080">, </font>op<font color="#000080">:</font><font color="#FF0000">CHAR</font><font color="#000080">, </font>n<font color="#000080">:</font><font color="#FF0000">INT</font><font color="#000080">), </font><font color="#FF0000">INT
    </font><font color="#008000"><b><i>'This sub checks of the operator at postion n in expr is a
</i></b>    <b><i>'legal operator. For example the &quot;+&quot; in &quot;2.3E+3&quot; is no operator,
</i></b>    <b><i>'and the &quot;-&quot; in &quot;3 * -2.5&quot; is no operator but a unary minus
</i></b>    </font><font color="#FF0000">STRING </font>sign
    
    <font color="#0000FF">IF </font>op<font color="#000080">=</font><font color="#800080">&quot;+&quot;
        </font><font color="#0000FF">IF UCASE$</font><font color="#000080">(</font><font color="#0000FF">MID$</font><font color="#000080">(</font>expr<font color="#000080">,</font>n<font color="#000080">-</font><b>1</b><font color="#000080">,</font><b>1</b><font color="#000080">))=</font><font color="#800080">&quot;E&quot;
            </font><font color="#0000FF">IF </font>n<font color="#000080">&gt;</font><b>2
</b>                <font color="#0000FF">IF INSTR</font><font color="#000080">(</font><font color="#800080">&quot;1234567890.&quot;</font><font color="#000080">, </font><font color="#0000FF">MID$</font><font color="#000080">(</font>expr<font color="#000080">,</font>n<font color="#000080">-</font><b>2</b><font color="#000080">,</font><b>1</b><font color="#000080">))&gt;</font><b>0
</b>                    <font color="#008000"><b><i>'for example &quot;2.52E+4&quot;
</i></b>                    </font><font color="#0000FF">RETURN </font><font color="#FF8000">FALSE
                </font><font color="#0000FF">ENDIF
            ENDIF
        ENDIF
        RETURN </font><font color="#FF8000">TRUE
    </font><font color="#0000FF">ENDIF
    
    IF </font>op<font color="#000080">=</font><font color="#800080">&quot;-&quot;
        </font><font color="#0000FF">IF </font>n<font color="#000080">=</font><b>1
</b>            <font color="#008000"><b><i>'this is an unary minus, at the first position of the expr
</i></b>            <b><i>'for example &quot;-3.4 / 6&quot;
</i></b>            </font><font color="#0000FF">RETURN </font><font color="#FF8000">FALSE
        </font><font color="#0000FF">ELSE
            </font><font color="#008000"><b><i>'check for an unary minus (for example 2*-3  or  2.5E-6)
</i></b>            <b><i>'check the characters before the minus
</i></b>            </font>sign <font color="#000080">= </font><font color="#0000FF">LEFT$</font><font color="#000080">(</font>expr<font color="#000080">,</font>n<font color="#000080">-</font><b>1</b><font color="#000080">)
            </font>sign <font color="#000080">= </font><font color="#0000FF">RIGHT$</font><font color="#000080">(</font><font color="#0000FF">RTRIM$</font><font color="#000080">(</font>sign<font color="#000080">),</font><b>1</b><font color="#000080">)
            </font><font color="#0000FF">IF INSTR</font><font color="#000080">(</font><font color="#800080">&quot;+-/*^&quot;</font><font color="#000080">, </font>sign<font color="#000080">)&gt;</font><b>0
</b>                <font color="#008000"><b><i>'For example &quot;3.5 * -2&quot;
</i></b>                </font><font color="#0000FF">RETURN </font><font color="#FF8000">FALSE
            </font><font color="#0000FF">ENDIF
            IF UCASE$</font><font color="#000080">(</font><font color="#0000FF">MID$</font><font color="#000080">(</font>expr<font color="#000080">,</font>n<font color="#000080">-</font><b>1</b><font color="#000080">,</font><b>1</b><font color="#000080">))=</font><font color="#800080">&quot;E&quot; </font><font color="#0000FF">AND </font>n<font color="#000080">&gt;</font><b>2
</b>                <font color="#0000FF">IF INSTR</font><font color="#000080">(</font><font color="#800080">&quot;1234567890.&quot;</font><font color="#000080">, </font><font color="#0000FF">MID$</font><font color="#000080">(</font>expr<font color="#000080">,</font>n<font color="#000080">-</font><b>2</b><font color="#000080">,</font><b>1</b><font color="#000080">))&gt;</font><b>0
</b>                    <font color="#008000"><b><i>'for example &quot;2.3E-4&quot;
</i></b>                    </font><font color="#0000FF">RETURN </font><font color="#FF8000">FALSE
                </font><font color="#0000FF">ENDIF
            ENDIF
        ENDIF
        RETURN </font><font color="#FF8000">TRUE
    </font><font color="#0000FF">ENDIF
    
    </font><font color="#008000"><b><i>'check if the E at position pos is an operator
</i></b>    </font><font color="#0000FF">IF </font>op<font color="#000080">=</font><font color="#800080">&quot;E&quot; </font><font color="#0000FF">OR </font>op<font color="#000080">=</font><font color="#800080">&quot;e&quot;
        </font><font color="#008000"><b><i>'if the E is at first or last postition in the expr, then it is no operator but the variable E
</i></b>        <b><i>'if left or right from E is no number or point, then it is no operator but the variable E
</i></b>        </font><font color="#0000FF">IF </font>n<font color="#000080">=</font><b>1</b> <font color="#0000FF">THEN RETURN </font><font color="#FF8000">FALSE
        </font><font color="#0000FF">IF </font>n<font color="#000080">=</font><font color="#0000FF">LEN</font><font color="#000080">(</font>expr<font color="#000080">) </font><font color="#0000FF">THEN RETURN </font><font color="#FF8000">FALSE
        </font><font color="#0000FF">IF INSTR</font><font color="#000080">(</font><font color="#800080">&quot;1234567890.&quot;</font><font color="#000080">, </font><font color="#0000FF">MID$</font><font color="#000080">(</font>expr<font color="#000080">,</font>n<font color="#000080">-</font><b>1</b><font color="#000080">,</font><b>1</b><font color="#000080">))=</font><b>0</b> <font color="#0000FF">THEN RETURN </font><font color="#FF8000">FALSE
        </font><font color="#0000FF">IF INSTR</font><font color="#000080">(</font><font color="#800080">&quot;1234567890.-+&quot;</font><font color="#000080">, </font><font color="#0000FF">MID$</font><font color="#000080">(</font>expr<font color="#000080">,</font>n<font color="#000080">+</font><b>1</b><font color="#000080">,</font><b>1</b><font color="#000080">))=</font><b>0</b> <font color="#0000FF">THEN RETURN </font><font color="#FF8000">FALSE
        </font><font color="#0000FF">RETURN </font><font color="#FF8000">TRUE
    </font><font color="#0000FF">ENDIF
    
    </font><font color="#008000"><b><i>'no problems found, the operator is indeed an operator.
</i></b>    </font><font color="#0000FF">RETURN </font><font color="#FF8000">TRUE
</font><font color="#0000FF">ENDSUB

</font><font color="#008000"><b><i>'_______________________________________________________________
</i></b></font><font color="#0000FF">SUB </font>isValue<font color="#000080">(</font>value<font color="#000080">:</font><font color="#FF0000">STRING</font><font color="#000080">), </font><font color="#FF0000">INT
    </font><font color="#008000"><b><i>'This sub checks if value is a legal value. if so, returns True.
</i></b>    <b><i>'If not, returns False
</i></b>    </font><font color="#FF0000">INT </font>i
    <font color="#FF0000">STRING </font>sign
    
    <font color="#0000FF">FOR </font>i<font color="#000080">=</font><b>1</b> <font color="#0000FF">TO LEN</font><font color="#000080">(</font>value<font color="#000080">)
        </font><font color="#008000"><b><i>'check each character one by one
</i></b>        </font>sign <font color="#000080">= </font><font color="#0000FF">UCASE$</font><font color="#000080">(</font><font color="#0000FF">MID$</font><font color="#000080">(</font>value<font color="#000080">,</font>i<font color="#000080">,</font><b>1</b><font color="#000080">))
        
        </font><font color="#008000"><b><i>'check for legal signs in the string
</i></b>        </font><font color="#0000FF">IF INSTR</font><font color="#000080">(</font><font color="#800080">&quot;1234567890.-&quot;</font><font color="#000080">, </font>sign<font color="#000080">)=</font><b>0</b> <font color="#0000FF">THEN RETURN </font><font color="#FF8000">FALSE
        
        </font><font color="#008000"><b><i>'check if there is max. 1 point in the string
</i></b>        </font><font color="#0000FF">IF </font>sign<font color="#000080">=</font><font color="#800080">&quot;.&quot; </font><font color="#0000FF">THEN IF INSTR</font><font color="#000080">(</font>value<font color="#000080">,</font><font color="#800080">&quot;.&quot;</font><font color="#000080">,</font>i<font color="#000080">+</font><b>1</b><font color="#000080">)&gt;</font><b>0</b> <font color="#0000FF">THEN RETURN </font><font color="#FF8000">FALSE
        
        </font><font color="#008000"><b><i>'check for correct use of minus: only at position 1
</i></b>        </font><font color="#0000FF">IF </font>sign<font color="#000080">=</font><font color="#800080">&quot;-&quot; </font><font color="#0000FF">THEN IF </font>i<font color="#000080">&lt;&gt;</font><b>1</b> <font color="#0000FF">THEN RETURN </font><font color="#FF8000">FALSE
    </font><font color="#0000FF">NEXT </font>i
    
    <font color="#0000FF">RETURN </font><font color="#FF8000">TRUE
</font><font color="#0000FF">ENDSUB

</font><font color="#008000"><b><i>'_______________________________________________________________
</i></b></font><font color="#0000FF">SUB </font>errSet<font color="#000080">(</font>msg<font color="#000080">:</font><font color="#FF0000">MESSAGE</font><font color="#000080">, </font>newType<font color="#000080">:</font><font color="#FF0000">INT</font><font color="#000080">, </font>newMessage<font color="#000080">:</font><font color="#FF0000">STRING</font><font color="#000080">)
    </font><font color="#008000"><b><i>'if msg is empty, then fill in the new type and message.
</i></b>    <b><i>'don't overwrite an existing message
</i></b>    </font><font color="#0000FF">IF </font>msg<font color="#000080">.</font>t <font color="#000080">= </font>MSG_EMPTY
        msg<font color="#000080">.</font>t <font color="#000080">= </font>newType
        msg<font color="#000080">.</font>desc <font color="#000080">= </font>newMessage
    <font color="#0000FF">ENDIF
    RETURN
ENDSUB

</font><font color="#008000"><b><i>'_______________________________________________________________
</i></b></font><font color="#0000FF">SUB </font>errClear<font color="#000080">(</font>msg<font color="#000080">:</font><font color="#FF0000">MESSAGE</font><font color="#000080">)
    </font><font color="#008000"><b><i>'clear the given message
</i></b>    </font>msg<font color="#000080">.</font>t <font color="#000080">= </font>MSG_EMPTY
    msg<font color="#000080">.</font>desc <font color="#000080">= </font><font color="#800080">&quot;&quot;
    </font><font color="#0000FF">RETURN
ENDSUB
</font></font>
</code></pre>
</body>
</html>